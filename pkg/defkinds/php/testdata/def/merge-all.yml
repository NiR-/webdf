# syntax=akerouanton/zbuilder:test9
fpm: true
version: 7.4.0

extensions:
  intl: "*"
  pdo_mysql: "*"
  soap: "*"

source_dirs:
  - 'generated/'

extra_scripts:
  - 'gencode.php'

stateful_dirs:
  - 'public/uploads'

config_files:
  fpm.conf: 'docker/app/fpm.conf'

post_install:
  - echo some command

stages:
  dev:
    dev: true
    config_files:
      php.ini: 'docker/app/php.dev.ini'

  prod:
    config_files:
      php.ini: 'docker/app/php.prod.ini'
    healthcheck: true
    integrations:
      - blackfire

  worker:
    derive_from: prod
    composer_dump:
      apcu: true
    source_dirs:
      - 'worker/'
    extra_scripts:
      - 'bin/worker'
    stateful_dirs:
      - 'data/imports'
    post_install:
      - echo some other command
    fpm: false
    command: bin/worker
